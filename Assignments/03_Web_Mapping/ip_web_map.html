<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>IP Geolocations Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Bitcount+Prop+Single:wght@100..900&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Bitcount Prop Single", sans-serif;
        background: white;
        color: black;
        margin: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        height: 100vh;
      }
      h1 {
        margin: 16px 0 0 0;
        font-size: 4em;
        text-align: center;
        font-weight: 300;
        font-style: italic;
      }
      h2 {
        font-size: 2em;
        margin: 0 0 16px 0;
        font-weight: 300;
        font-style: italic;
      }
      #map {
        width: 80vw;
        height: 80vh;
        border-radius: 18px;
        margin-bottom: 32px;
      }
      #bg-dots {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: 0;
      }
      #bg {
        background-color: white;
        z-index: 1;
        padding: 16px;
      }
    </style>
  </head>
  <body>
    <canvas id="bg-dots"></canvas>
    <div id="bg">
      <h1>www.pinterest.com</h1>
    </div>
    <div id="bg">
      <h2>ip geolocations</h2>
    </div>
    <div id="map"></div>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
    <script>
      mapboxgl.accessToken =
        "pk.eyJ1IjoiZW00MDIwIiwiYSI6ImNtZDZ2dnFtZDBlNGkya3B1dnNtbGg5anEifQ.LY4KkznodYoTEhBH3kVYFg";

      const map = new mapboxgl.Map({
        container: "map",
        style: "mapbox://styles/mapbox/dark-v11",
        center: [-98.5, 39.8],
        zoom: 3,
      });

      // Load GeoJSON points and add to map
      fetch("ip_locations.geojson")
        .then((response) => response.json())
        .then((data) => {
          map.on("load", () => {
            map.addSource("ip-points", {
              type: "geojson",
              data: data,
            });
            map.addLayer({
              id: "ip-points-layer",
              type: "circle",
              source: "ip-points",
              paint: {
                "circle-radius": 5,
                "circle-color": "white",
                "circle-stroke-width": 2,
                "circle-stroke-color": "red",
              },
            });

            map.on("click", "ip-points-layer", (e) => {
              const coordinates = e.features[0].geometry.coordinates.slice();
              const props = e.features[0].properties;
              let html = "";
              for (const key in props) {
                html += `<strong>${key}:</strong> ${props[key]}<br>`;
              }
              new mapboxgl.Popup()
                .setLngLat(coordinates)
                .setHTML(html)
                .addTo(map);
            });

            map.on("mouseenter", "ip-points-layer", () => {
              map.getCanvas().style.cursor = "pointer";
            });
            map.on("mouseleave", "ip-points-layer", () => {
              map.getCanvas().style.cursor = "";
            });
          });
        });
    </script>
    <script>
      const CHARS = ["*", ".", "÷º ÷∂÷∏÷¢.", "‚Äπùüπ", "‚Ä¢", "‚ÇäÀö‚äπ‚ãÜ", "¬∞", "·Øì‚òÖ"];
      const DOTS = 1000;
      const canvas = document.getElementById("bg-dots");
      const ctx = canvas.getContext("2d");
      let w = window.innerWidth,
        h = window.innerHeight;
      canvas.width = w;
      canvas.height = h;

      function random(min, max) {
        return Math.random() * (max - min) + min;
      }

      const dots = [];
      for (let i = 0; i < DOTS; i++) {
        dots.push({
          x: random(0, w),
          y: random(0, h),
          size: random(1, 20),
          dx: random(-0.5, 0.5),
          dy: random(-0.5, 0.5),
          char: CHARS[Math.floor(random(0, CHARS.length))],
        });
      }

      function animateDots() {
        ctx.clearRect(0, 0, w, h);
        for (let dot of dots) {
          dot.x += dot.dx;
          dot.y += dot.dy;
          if (dot.x < 0 || dot.x > w) dot.dx *= -1;
          if (dot.y < 0 || dot.y > h) dot.dy *= -1;
          ctx.font = `${dot.size}px monospace`;
          ctx.fillStyle = dot.color;
          ctx.fillText(dot.char, dot.x, dot.y);
        }
        requestAnimationFrame(animateDots);
      }
      animateDots();

      window.addEventListener("resize", () => {
        w = window.innerWidth;
        h = window.innerHeight;
        canvas.width = w;
        canvas.height = h;
      });
    </script>
  </body>
</html>
